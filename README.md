# XSYUDormPowerSpider - v2.0
西安石油大学宿舍电量查询与分析系统

![v2.0 最新功能展示](https://raw.githubusercontent.com/shaozheng0503/XSYUDormPowerSpider/main/img/202507102121.png)

## 项目背景
西安石油大学的同学们需要频繁登录小程序来查询宿舍的剩余电量，手动操作的流程不仅繁琐，还容易出现交错电费的情况。本项目利用爬虫技术自动化获取电量数据，并结合数据可视化与便捷功能，能够大幅提升查询效率，减少操作成本。

## v2.0 版本更新亮点
本次更新在保留原有核心功能的基础上，对界面和数据分析能力进行了大幅度升级：
- **全新交互界面**：引入 `ttkbootstrap` 框架重构界面，支持主题切换，UI更美观、更现代化。
- **专业用电分析**：新增“用电量分析”功能。利用 `pandas` 库，现在可以按不同时间粒度（每日、每12小时、每6小时）精确计算**用电消耗**，而不仅仅是查看剩余电量。
- **交互式图表**：历史数据图表增加了**鼠标悬停**显示功能，数据详情一目了然。

## 核心功能
### 1. 宿舍电量快速查询
用户只需输入宿舍编号，即可快速获取当天剩余电量。程序会根据输入的宿舍编号，自动从学校相关网站爬取对应宿舍的电量信息并展示给用户。查询支持模糊搜索。

### 2. 耗电数据可视化监测
- **实时记录**：程序会实时记录每天的耗电数据，确保数据的及时性和准确性。
- **趋势展示**：自动生成剩余电量趋势折线图，并新增用电量消耗分析图，让用户能从多个维度直观地了解宿舍的用电情况。
- **历史回溯**：数据会存储至本地数据库（`electricity_data.db`），支持历史记录回溯，方便用户随时查看过去的用电数据。

### 3. 电费充值快捷入口
用户可以通过一键操作跳转至学校官方充值界面，无需再手动输入网址或进行复杂的查找，方便快捷地完成电费充值。

### 4. 一键生成桌面摆件
用户可以一键生成简洁方便的桌面摆件，该摆件会实时显示宿舍的电量信息，并根据电量高低变换颜色。

### 另外
我们还创意性的将电量显示移植到了esp32开发板上，使得宿舍电量能够实时显示在oled屏幕上。

## 爬虫模块
本项目的爬虫模块基于 Python 的 `requests`与 `BeautifulSoup`库实现网页解析。`requests`库用于发送 HTTP 请求，获取学校电量查询页面的 HTML 内容；`BeautifulSoup`库则用于解析 HTML 内容，提取出所需的电量信息。

## 硬件交互模块
- **主控芯片**：ESP32
- **编程语言**：MicroPython
- **显示设备**：OLED 屏幕
- **通信方式**：Wi-Fi

## 项目结构
```
XSYUDormPowerSpider-main/
├── v1.0/
│   ├── main_app.py          # 主程序，实现电量查询与充值系统的界面和逻辑
│   ├── widget.py            # 桌面小摆件程序，实时显示宿舍电量
│   ├── database.py          # 数据库操作模块，用于获取电量记录
│   ├── scraper.py           # 爬虫模块
│   ├── config.py            # 配置管理模块
│   ├── utils.py             # 工具函数模块
│   ├── dorm_rooms_2025.csv  # 宿舍信息文件
│   └── selected_dorm.cfg    # 配置文件，记录已选择的宿舍信息
├── img/
│   └── 202507102121.png     # 项目功能截图
├── LICENSE                  # 项目许可证文件
├── requirements.txt         # Python依赖文件
└── README.md                # 项目说明文档
```

## 项目作者
- **机械师**
  - 职责：负责爬虫核心开发、逻辑优化、数据库设计以及 Windows 桌面程序开发（exe 封装）。
- **LaplaceHe**
  - 职责：完成爬虫初始逻辑的编写、ESP32 单片机程序的开发以及 Android APP 框架的搭建。

## 使用指南
### 1. 环境部署
```bash
# 克隆仓库
git clone https://github.com/shaozheng0503/XSYUDormPowerSpider.git
cd XSYUDormPowerSpider

# 安装Python依赖
pip install -r requirements.txt
```
> **注意**: v2.0 版本新增了 `pandas` 和 `ttkbootstrap` 等依赖，请确保已通过 `requirements.txt` 正确安装。

### 2. 运行程序
运行 `XSYUDormPowerSpider-main/v1.0/main_app.py` 文件，启动宿舍电量查询与充值系统。

### 3. 生成桌面摆件
在主程序界面中，选择宿舍后，点击 “创建桌面小摆件” 按钮，即可生成实时显示宿舍电量的桌面摆件。

### 4. ESP32 硬件配置
将 ESP32 开发板连接到电源和 Wi-Fi 网络，上传 MicroPython 程序（`DormElectrics.py`）到 ESP32，确保其能够与爬虫程序进行数据交互。

## 联系方式
如有问题或合作需求，可通过以下方式联系：
- 机械师 QQ：2126319400
- LaplaceHe QQ：2590979868

## 欢迎大家Fork本项目

## 许可证
MIT 许可证 